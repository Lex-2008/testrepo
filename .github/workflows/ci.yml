name: CI

on:
  push:
  pull_request:

jobs:
  build-no-ccache:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Install CMake
        uses: lukka/get-cmake@v5

      - name: Configure and build without ccache
        run: |
          cmake . -B build/no_ccache -DCMAKE_BUILD_TYPE=Release
          cmake --build build/no_ccache --config Release

  build-with-ccache:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Install CMake
        uses: lukka/get-cmake@v5

      - name: Install ccache
        run: choco install ccache -y

      - name: Configure ccache
        run: |
          ccache --version
          ccache --zero-stats

      - name: Configure and build with ccache
        env:
          CC: cl
          CXX: cl
          CCACHE_BASEDIR: ${{ github.workspace }}
          CCACHE_DIR: ${{ github.workspace }}\.ccache
        run: |
          cmake . -B build/with_ccache -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_COMPILER_LAUNCHER=ccache
          cmake --build build/with_ccache --config Release
          ccache --show-stats
