name: CI

on:
  push:
  pull_request:

jobs:
  build-no-ccache:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Build without ccache
        run: |
          cl /std:c++17 hello.cpp /Fe:hello_no_ccache.exe

  build-with-ccache:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: Install ccache
        run: |
          choco install ccache -y

      - name: Configure ccache
        run: |
          ccache --version
          ccache --zero-stats

      - name: Build with ccache
        env:
          CC: cl
          CXX: cl
          CCACHE_BASEDIR: ${{ github.workspace }}
          CCACHE_DIR: ${{ github.workspace }}\.ccache
        run: |
          ccache cl /std:c++17 hello.cpp /Fe:hello_with_ccache.exe
          ccache --show-stats

